{% for i in websites %} 

{% if not i.host in hostvars %}
# verify if i is in hostvars
# si non présent, declarer un host pour ça ??
define host {
        use                     linux-server
        host_name               {{ i.host }}
        address                 {{ i.host }}
        contact_groups          {{ i.admin | default('default') }}
}
{% endif %}

{% if i.use_ssl is defined %}
define service {
        use                     generic-service
        host_name               {{ i.host }}
        service_description     HTTPS
        check_command           check_http!-S -u {{ i.url | default('/') }} -H {{ i.host }} {% if i.username is defined %} -a {{ i.username }}:{{ i.password }} {% endif %}

        contact_groups          {{ i.admin | default('default') }}
}
{% endif %}

define service {
        use                     generic-service
        host_name               {{ i.host }}
        service_description     HTTP
        check_command           check_http!-u {{ i.url | default('/') }} -H {{ i.host }} {% if i.username is defined %} -a {{ i.username }}:{{ i.password }} {% endif %}

        contact_groups          {{ i.admin | default('default') }}
}
{% endfor %}

{% for i in smtp_servers %}
define service {
        use                     generic-service
        host_name               {{ i }}
        service_description     SMTP
        check_command           check_smtp
        contact_groups          default
}
{% endfor %}
